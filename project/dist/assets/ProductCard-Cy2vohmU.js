import{u as x,s as R,a as y,f as M,c as g,b as S,d as P}from"./client-DyxrDyWu.js";import{S as E,s as C,g as O,n as m,p as j,b,r as h,_ as c,Q as p,j as o,a as w}from"./index-y7EDUPGa.js";import{F as N}from"./index.esm-Au-dWfFO.js";class Q extends E{constructor(t,e){super(),this.client=t,this.setOptions(e),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var e;const r=this.options;this.options=this.client.defaultMutationOptions(t),C(r,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(e=this.currentMutation)==null||e.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var t;(t=this.currentMutation)==null||t.removeObserver(this)}}onMutationUpdate(t){this.updateResult();const e={listeners:!0};t.type==="success"?e.onSuccess=!0:t.type==="error"&&(e.onError=!0),this.notify(e)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,e){return this.mutateOptions=e,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof t<"u"?t:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:O(),e={...t,isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=e}notify(t){m.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(t.onSuccess){var e,r,i,s;(e=(r=this.mutateOptions).onSuccess)==null||e.call(r,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(i=(s=this.mutateOptions).onSettled)==null||i.call(s,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(t.onError){var u,l,n,d;(u=(l=this.mutateOptions).onError)==null||u.call(l,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(n=(d=this.mutateOptions).onSettled)==null||n.call(d,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}t.listeners&&this.listeners.forEach(({listener:v})=>{v(this.currentResult)})})}}function f(a,t,e){const r=j(a,t,e),i=b({context:r.context}),[s]=h.useState(()=>new Q(i,r));h.useEffect(()=>{s.setOptions(r)},[s,r]);const u=x(h.useCallback(n=>s.subscribe(m.batchCalls(n)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),l=h.useCallback((n,d)=>{s.mutate(n,d).catch(U)},[s]);if(u.error&&R(s.options.useErrorBoundary,[u.error]))throw u.error;return{...u,mutate:l,mutateAsync:u.mutate}}function U(){}const L=a=>{const t=b(),e=y([p.PRODUCTS,a],()=>M(a),{onError:()=>{c.error("Failed to fetch products")}}),r=f(g,{onSuccess:()=>{t.invalidateQueries([p.PRODUCTS]),c.success("Product created successfully")},onError:()=>{c.error("Failed to create product")}}),i=f(S,{onSuccess:()=>{t.invalidateQueries([p.PRODUCTS]),c.success("Product updated successfully")},onError:()=>{c.error("Failed to update product")}}),s=f(P,{onSuccess:()=>{t.invalidateQueries([p.PRODUCTS]),c.success("Product deleted successfully")},onError:()=>{c.error("Failed to delete product")}});return{products:e.data,isLoading:e.isLoading,error:e.error,createProduct:r.mutate,updateProduct:i.mutate,deleteProduct:s.mutate}};function T({product:a}){const{id:t,name:e,category:r,quantity:i,rating:s,image:u}=a;return o.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[o.jsx("img",{src:u,alt:e,className:"w-full h-48 object-cover"}),o.jsxs("div",{className:"p-4",children:[o.jsx("h3",{className:"text-lg font-semibold",children:e}),o.jsx("p",{className:"text-sm text-gray-600",children:r}),o.jsx("div",{className:"flex items-center mt-2",children:[...Array(5)].map((l,n)=>o.jsx(N,{className:`${n<s?"text-yellow-400":"text-gray-300"} w-4 h-4`},n))}),o.jsx("p",{className:"mt-2 text-sm",children:i>0?`${i} in stock`:"Out of stock"}),o.jsx(w,{to:`/product/${t}`,className:"mt-4 block text-center bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600",children:"View Details"})]})]})}export{T as P,L as u};
